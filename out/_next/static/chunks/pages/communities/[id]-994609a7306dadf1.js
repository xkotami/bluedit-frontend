(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[379],{8121:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/communities/[id]",function(){return n(2724)}])},2724:function(e,t,n){"use strict";n.r(t);var i=n(5893),s=n(7294),o=n(1163),r=n(9008),a=n.n(r),l=n(7331),d=n(3479);t.default=()=>{var e;let[t,n]=(0,s.useState)(null),[r,c]=(0,s.useState)([]),[x,p]=(0,s.useState)([]),[u,h]=(0,s.useState)(!0),[m,g]=(0,s.useState)(!0),[y,f]=(0,s.useState)(""),[j,b]=(0,s.useState)(!1),v=(0,o.useRouter)(),{id:w}=v.query;(0,s.useEffect)(()=>{w&&(C(),S(),(0,d.$8)()&&k())},[w]);let C=async()=>{try{let e=await d.uv.getCommunityById(parseInt(w));e.success&&e.data?n(e.data):f("Community not found")}catch(e){f("Failed to load community")}finally{h(!1)}},S=async()=>{try{let e=await d.WY.getPostsByCommunity(w);if(e.success&&e.data){let t=e.data.filter(e=>e&&e.createdAt).sort((e,t)=>{let n=new Date(e.createdAt),i=new Date(t.createdAt);return isNaN(n.getTime())?1:isNaN(i.getTime())?-1:i.getTime()-n.getTime()});c(t)}else c([])}catch(e){console.error("Failed to load community posts:",e),c([])}finally{g(!1)}},k=async()=>{try{let e=await d.uv.getUserCommunities();e.success&&e.data&&p(e.data)}catch(e){console.error("Failed to load user communities:",e)}},D=async()=>{if(!(0,d.$8)()){await v.push("/login");return}b(!0);try{let e=await d.uv.joinCommunity(t.id);e.success?(await k(),await C(),f("")):f(e.error||"Failed to join community")}catch(e){f("Failed to join community")}finally{b(!1)}},B=async()=>{b(!0);try{let e=await d.uv.leaveCommunity(t.id);e.success?(await k(),await C(),f("")):f(e.error||"Failed to leave community")}catch(e){f("Failed to leave community")}finally{b(!1)}},z=()=>x.some(e=>e.id===(null==t?void 0:t.id)),F=e=>{if(!e)return"Unknown time";let t=new Date,n=new Date(e);if(isNaN(n.getTime()))return"Invalid date";let i=Math.floor((t.getTime()-n.getTime())/36e5),s=Math.floor(i/24);return i<1?"Less than an hour ago":i<24?"".concat(i," hour").concat(i>1?"s":""," ago"):s<7?"".concat(s," day").concat(s>1?"s":""," ago"):n.toLocaleDateString()},N=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return e.length<=t?e:e.substring(0,t)+"..."},_=async e=>{await v.push("/posts/".concat(e))},T={maxWidth:"900px",margin:"0 auto",padding:"20px",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},R={display:"flex",alignItems:"center",gap:"4px"},A={backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"6px",padding:"10px 20px",fontSize:"14px",fontWeight:"600",cursor:"pointer",textDecoration:"none",display:"inline-block"},I={backgroundColor:"#6c757d",cursor:"not-allowed"},W={backgroundColor:"white",border:"1px solid #e1e1e1",borderRadius:"8px",padding:"20px",marginBottom:"16px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",transition:"box-shadow 0.2s ease, transform 0.1s ease",cursor:"pointer"},L={boxShadow:"0 4px 8px rgba(0,0,0,0.15)",transform:"translateY(-1px)"},E={display:"flex",alignItems:"center",marginBottom:"12px",fontSize:"14px",color:"#666"},P={color:"#333",fontWeight:"500"},M={color:"#28a745",fontSize:"12px",marginLeft:"4px"},O={margin:"0 8px",color:"#ccc"},$={fontSize:"18px",fontWeight:"600",color:"#1a1a1a",marginBottom:"12px",lineHeight:"1.3"},H={fontSize:"15px",lineHeight:"1.5",color:"#333",marginBottom:"16px"},U={display:"flex",alignItems:"center",gap:"16px",fontSize:"14px",color:"#666"},Z={textAlign:"center",padding:"60px 20px",fontSize:"18px",color:"#666"};return u?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(a(),{children:[(0,i.jsx)("title",{children:"Community | Setback"}),(0,i.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"})]}),(0,i.jsx)(l.Z,{}),(0,i.jsx)("div",{style:T,children:(0,i.jsx)("div",{style:Z,children:"Loading community..."})})]}):y||!t?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(a(),{children:[(0,i.jsx)("title",{children:"Community | Setback"}),(0,i.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"})]}),(0,i.jsx)(l.Z,{}),(0,i.jsx)("div",{style:T,children:(0,i.jsx)("div",{style:{textAlign:"center",padding:"40px 20px",backgroundColor:"#f8d7da",color:"#721c24",borderRadius:"8px",margin:"20px",border:"1px solid #f5c6cb"},children:y||"Community not found"})})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(a(),{children:[(0,i.jsxs)("title",{children:["r/",t.name," | Setback"]}),(0,i.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"})]}),(0,i.jsx)(l.Z,{}),(0,i.jsxs)("div",{style:T,children:[(0,i.jsx)("a",{href:"/community",style:{backgroundColor:"transparent",color:"#007bff",border:"1px solid #007bff",borderRadius:"6px",padding:"8px 16px",fontSize:"14px",cursor:"pointer",marginBottom:"20px",textDecoration:"none",display:"inline-block"},children:"← Back to Communities"}),(0,i.jsxs)("div",{style:{backgroundColor:"white",border:"1px solid #e1e1e1",borderRadius:"8px",padding:"24px",marginBottom:"24px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[(0,i.jsxs)("h1",{style:{fontSize:"32px",fontWeight:"700",color:"#1a1a1a",marginBottom:"8px"},children:["r/",t.name]}),(0,i.jsxs)("div",{style:{display:"flex",gap:"24px",marginBottom:"16px",fontSize:"14px",color:"#666"},children:[(0,i.jsxs)("div",{style:R,children:[(0,i.jsx)("span",{children:"\uD83D\uDC65"}),(0,i.jsxs)("span",{children:[(null===(e=t.users)||void 0===e?void 0:e.length)||0," members"]})]}),(0,i.jsxs)("div",{style:R,children:[(0,i.jsx)("span",{children:"\uD83D\uDCDD"}),(0,i.jsxs)("span",{children:[r.length," posts"]})]}),(0,i.jsxs)("div",{style:R,children:[(0,i.jsx)("span",{children:"\uD83D\uDCC5"}),(0,i.jsxs)("span",{children:["Created ",F(t.createdAt)]})]})]}),(0,i.jsx)("p",{style:{fontSize:"16px",lineHeight:"1.5",color:"#555",marginBottom:"20px"},children:t.description}),(0,i.jsx)("div",{style:{display:"flex",gap:"12px",alignItems:"center"},children:(0,d.$8)()&&(0,i.jsxs)(i.Fragment,{children:[z()?(0,i.jsx)("button",{style:{backgroundColor:"#dc3545",color:"white",border:"none",borderRadius:"6px",padding:"10px 20px",fontSize:"14px",fontWeight:"600",cursor:"pointer",...j?I:{}},onClick:B,disabled:j,children:j?"Leaving...":"Leave Community"}):(0,i.jsx)("button",{style:{backgroundColor:"#28a745",color:"white",border:"none",borderRadius:"6px",padding:"10px 20px",fontSize:"14px",fontWeight:"600",cursor:"pointer",...j?I:{}},onClick:D,disabled:j,children:j?"Joining...":"Join Community"}),z()&&(0,i.jsx)("a",{href:"/posts/create",style:A,children:"Create Post"})]})})]}),(0,i.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px",paddingBottom:"16px",borderBottom:"1px solid #e1e1e1"},children:(0,i.jsxs)("h2",{style:{fontSize:"20px",fontWeight:"600",color:"#333",margin:0},children:["Posts (",r.length,")"]})}),m?(0,i.jsx)("div",{style:Z,children:"Loading posts..."}):0===r.length?(0,i.jsxs)("div",{style:{textAlign:"center",padding:"60px 20px",backgroundColor:"#f8f9fa",borderRadius:"8px",color:"#666"},children:[(0,i.jsx)("h3",{children:"No posts yet"}),(0,i.jsxs)("p",{children:["Be the first to share something in r/",t.name,"!"]}),(0,d.$8)()&&z()&&(0,i.jsx)("a",{href:"/posts/create",style:A,children:"Create First Post"})]}):(0,i.jsx)("div",{children:r.map(e=>{var t,n;return(0,i.jsxs)("div",{style:W,onClick:()=>_(e.id),onMouseEnter:e=>Object.assign(e.currentTarget.style,L),onMouseLeave:e=>Object.assign(e.currentTarget.style,W),children:[(0,i.jsxs)("div",{style:E,children:[(0,i.jsx)("span",{children:"Posted by "}),(0,i.jsxs)("span",{style:P,children:["u/",e.user.username]}),(0,i.jsxs)("span",{style:M,children:["(",e.user.points," pts)"]}),(0,i.jsx)("span",{style:O,children:"•"}),(0,i.jsx)("span",{children:F(e.createdAt)})]}),(0,i.jsx)("h3",{style:$,children:e.title}),(0,i.jsx)("p",{style:H,children:N(e.content)}),(0,i.jsxs)("div",{style:U,children:[(0,i.jsxs)("div",{style:R,children:[(0,i.jsx)("span",{children:"▲"}),(0,i.jsx)("span",{children:(null===(t=e.comments)||void 0===t?void 0:t.length)||0})]}),(0,i.jsxs)("div",{style:R,children:[(0,i.jsx)("span",{children:"\uD83D\uDCAC"}),(0,i.jsxs)("span",{children:[(null===(n=e.comments)||void 0===n?void 0:n.length)||0," comments"]})]})]})]},e.id)})})]})]})}},9008:function(e,t,n){e.exports=n(3867)}},function(e){e.O(0,[424,219,888,774,179],function(){return e(e.s=8121)}),_N_E=e.O()}]);