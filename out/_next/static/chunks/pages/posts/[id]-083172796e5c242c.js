(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[646],{7411:function(e,t,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/posts/[id]",function(){return o(1344)}])},1344:function(e,t,o){"use strict";o.r(t);var i=o(5893),n=o(7294),r=o(1163),s=o(9008),l=o.n(s),d=o(5247),a=o(4746);t.default=()=>{var e,t,o;let[s,c]=(0,n.useState)(null),[p,x]=(0,n.useState)(!0),[u,h]=(0,n.useState)(""),[g,m]=(0,n.useState)(""),[y,f]=(0,n.useState)({}),[b,j]=(0,n.useState)({}),[v,w]=(0,n.useState)(!1),[S,C]=(0,n.useState)(null),[k,B]=(0,n.useState)(null),z=(0,r.useRouter)(),{id:R}=z.query;(0,n.useEffect)(()=>{R&&(I(),F())},[R]);let F=async()=>{try{if((0,a.$8)()){let e=await a.ON.getCurrentUser();B(e)}}catch(e){console.error("Failed to load current user:",e)}},I=async()=>{try{let e=await a.WY.getPostById(R);e.success&&e.data?c(e.data):h("Post not found")}catch(e){h("Failed to load post"),console.error("Error loading post:",e)}finally{x(!1)}},_=async e=>{if(e.preventDefault(),g.trim()&&(null==s?void 0:s.id)){if(!(0,a.$8)()||!(null==k?void 0:k.id)){z.push("/login");return}w(!0),h("");try{let e={text:g.trim(),postId:s.id,userId:k.id};console.log("Creating comment with data:",e);let t=await a.a$.createComment(e);if(t.success)m(""),await I(),console.log("Comment created successfully");else{let e=t.error||"Failed to create comment";h(e),console.error("Failed to create comment:",e)}}catch(e){h((null==e?void 0:e.message)||"Failed to create comment"),console.error("Error creating comment:",e)}finally{w(!1)}}},E=async(e,t)=>{let o=y[e];if(null==o?void 0:o.trim()){if(!(0,a.$8)()||!(null==k?void 0:k.id)){z.push("/login");return}C(e),h("");try{let i={text:o.trim(),postId:t,userId:k.id,parentId:e};console.log("Creating reply with data:",i);let n=await a.a$.createReply(i);if(n.success)f(t=>({...t,[e]:""})),j(t=>({...t,[e]:!1})),await I(),console.log("Reply created successfully");else{let e=n.error||"Failed to create reply";h(e),console.error("Failed to create reply:",e)}}catch(e){h((null==e?void 0:e.message)||"Failed to create reply"),console.error("Error creating reply:",e)}finally{C(null)}}},D=e=>{j(t=>({...t,[e]:!t[e]})),b[e]||h("")},P=e=>{let t=new Date,o=new Date(e),i=Math.floor((t.getTime()-o.getTime())/36e5),n=Math.floor(i/24);return i<1?"Less than an hour ago":i<24?"".concat(i," hour").concat(i>1?"s":""," ago"):n<7?"".concat(n," day").concat(n>1?"s":""," ago"):o.toLocaleDateString()},T=e=>{var t;let{comment:o,depth:n}=e;return(0,i.jsxs)("div",{style:{marginLeft:"".concat(Math.min(20*n,100),"px"),borderLeft:n>0?"2px solid #e1e1e1":"none",paddingLeft:n>0?"16px":"0",marginBottom:"16px"},children:[(0,i.jsxs)("div",{style:Z,children:[(0,i.jsxs)("div",{style:q,children:[(0,i.jsxs)("div",{style:U,children:[(0,i.jsxs)("span",{style:L,children:["u/",o.createdBy.username]}),(0,i.jsxs)("span",{style:N,children:["(",o.createdBy.points," pts)"]})]}),(0,i.jsxs)("div",{style:X,children:[(0,i.jsxs)("span",{style:Y,children:["▲ ",o.points]}),(0,i.jsx)("span",{style:$,children:"•"}),(0,i.jsx)("span",{style:A,children:P(o.createdAt)})]})]}),(0,i.jsx)("div",{style:G,children:o.text}),(0,i.jsx)("div",{style:J,children:(0,a.$8)()&&(0,i.jsx)("button",{style:K,onClick:()=>D(o.id),children:"Reply"})}),b[o.id]&&(0,i.jsxs)("div",{style:Q,children:[(0,i.jsx)("textarea",{value:y[o.id]||"",onChange:e=>f(t=>({...t,[o.id]:e.target.value})),placeholder:"Write a reply...",style:V,rows:3}),(0,i.jsxs)("div",{style:ee,children:[(0,i.jsx)("button",{onClick:()=>E(o.id,s.id),disabled:S===o.id||!(null===(t=y[o.id])||void 0===t?void 0:t.trim()),style:et,children:S===o.id?"Replying...":"Reply"}),(0,i.jsx)("button",{onClick:()=>D(o.id),style:eo,children:"Cancel"})]})]})]}),o.replies&&o.replies.map(e=>(0,i.jsx)(T,{comment:e,depth:n+1},e.id))]})},W={maxWidth:"800px",margin:"0 auto",padding:"20px",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},L={color:"#333",fontWeight:"600"},N={color:"#28a745",fontSize:"12px",marginLeft:"4px"},$={color:"#ccc"},A={color:"#888"},O={display:"flex",alignItems:"center",gap:"4px"},H={width:"100%",padding:"12px 16px",border:"2px solid #e1e1e1",borderRadius:"6px",fontSize:"14px",fontFamily:"inherit",resize:"vertical",boxSizing:"border-box",lineHeight:"1.5",outline:"none"},M={borderColor:"#007bff",boxShadow:"0 0 0 3px rgba(0, 123, 255, 0.1)"},Z={backgroundColor:"#f8f9fa",border:"1px solid #e9ecef",borderRadius:"6px",padding:"16px",marginBottom:"12px"},q={display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},U={display:"flex",alignItems:"center"},X={display:"flex",alignItems:"center",gap:"8px",fontSize:"12px"},Y={color:"#28a745",fontWeight:"600"},G={fontSize:"14px",lineHeight:"1.5",marginBottom:"12px",color:"#333",whiteSpace:"pre-wrap"},J={display:"flex",gap:"12px"},K={background:"none",border:"none",color:"#007bff",fontSize:"12px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s ease"},Q={marginTop:"16px",padding:"16px",backgroundColor:"white",border:"1px solid #ddd",borderRadius:"6px"},V={width:"100%",padding:"10px 12px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"13px",fontFamily:"inherit",resize:"vertical",boxSizing:"border-box",outline:"none"},ee={display:"flex",gap:"8px",marginTop:"12px"},et={backgroundColor:"#28a745",color:"white",border:"none",borderRadius:"4px",padding:"6px 12px",fontSize:"12px",cursor:"pointer",opacity:S?.6:1,pointerEvents:S?"none":"auto"},eo={backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"4px",padding:"6px 12px",fontSize:"12px",cursor:"pointer"},ei={backgroundColor:"#f8d7da",color:"#721c24",padding:"12px 16px",borderRadius:"6px",marginBottom:"20px",border:"1px solid #f5c6cb"};if(p)return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(l(),{children:[(0,i.jsx)("title",{children:"Post | Setback"}),(0,i.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"})]}),(0,i.jsx)(d.Z,{}),(0,i.jsx)("div",{style:W,children:(0,i.jsx)("div",{style:{textAlign:"center",padding:"60px",fontSize:"18px",color:"#666"},children:"Loading post..."})})]});if(!s)return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(l(),{children:[(0,i.jsx)("title",{children:"Post Not Found | Setback"}),(0,i.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"})]}),(0,i.jsx)(d.Z,{}),(0,i.jsx)("div",{style:W,children:(0,i.jsx)("div",{style:ei,children:"Post not found"})})]});let en=(null===(e=s.comments)||void 0===e?void 0:e.filter(e=>!e.parent))||[];return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(l(),{children:[(0,i.jsxs)("title",{children:[s.title," | Setback"]}),(0,i.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"})]}),(0,i.jsx)(d.Z,{}),(0,i.jsxs)("div",{style:W,children:[(0,i.jsx)("button",{onClick:()=>z.back(),style:{backgroundColor:"transparent",color:"#007bff",border:"1px solid #007bff",borderRadius:"6px",padding:"8px 16px",fontSize:"14px",cursor:"pointer",marginBottom:"20px",textDecoration:"none",display:"inline-block"},children:"← Back"}),u&&(0,i.jsx)("div",{style:ei,children:u}),(0,i.jsxs)("div",{style:{backgroundColor:"white",border:"1px solid #e1e1e1",borderRadius:"8px",padding:"24px",marginBottom:"24px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[(0,i.jsx)("h1",{style:{fontSize:"28px",fontWeight:"700",color:"#1a1a1a",marginBottom:"16px",lineHeight:"1.3"},children:s.title}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"20px",fontSize:"14px",color:"#666"},children:[(0,i.jsx)("span",{style:{color:"#007bff",fontWeight:"600",textDecoration:"none"},children:"r/community"}),(0,i.jsx)("span",{style:$,children:"•"}),(0,i.jsx)("span",{children:"Posted by "}),(0,i.jsxs)("span",{style:L,children:["u/",s.user.username]}),(0,i.jsxs)("span",{style:N,children:["(",s.user.points," pts)"]}),(0,i.jsx)("span",{style:$,children:"•"}),(0,i.jsx)("span",{style:A,children:P(s.createdAt)})]}),(0,i.jsx)("div",{style:{fontSize:"16px",lineHeight:"1.6",color:"#333",marginBottom:"20px",whiteSpace:"pre-wrap"},children:s.content}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"16px",paddingTop:"16px",borderTop:"1px solid #e1e1e1",fontSize:"14px",color:"#666"},children:[(0,i.jsxs)("div",{style:O,children:[(0,i.jsx)("span",{children:"▲"}),(0,i.jsx)("span",{children:(null===(t=s.comments)||void 0===t?void 0:t.length)||0})]}),(0,i.jsxs)("div",{style:O,children:[(0,i.jsx)("span",{children:"\uD83D\uDCAC"}),(0,i.jsxs)("span",{children:[(null===(o=s.comments)||void 0===o?void 0:o.length)||0," comments"]})]})]})]}),(0,i.jsxs)("div",{style:{backgroundColor:"white",border:"1px solid #e1e1e1",borderRadius:"8px",padding:"24px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[(0,i.jsxs)("h3",{style:{fontSize:"20px",fontWeight:"600",color:"#333",marginBottom:"20px"},children:["Comments (",en.length,")"]}),(0,a.$8)()&&k?(0,i.jsxs)("form",{onSubmit:_,style:{marginBottom:"24px",paddingBottom:"24px",borderBottom:"1px solid #e1e1e1"},children:[(0,i.jsx)("textarea",{value:g,onChange:e=>m(e.target.value),placeholder:"Share your thoughts...",style:H,rows:4,required:!0,disabled:v,onFocus:e=>Object.assign(e.target.style,M),onBlur:e=>Object.assign(e.target.style,H)}),(0,i.jsx)("button",{type:"submit",disabled:v||!g.trim(),style:{backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"6px",padding:"10px 20px",fontSize:"14px",fontWeight:"600",cursor:"pointer",marginTop:"12px",opacity:v?.6:1,pointerEvents:v?"none":"auto"},children:v?"Posting...":"Post Comment"})]}):(0,i.jsx)("div",{style:{textAlign:"center",padding:"20px",backgroundColor:"#f8f9fa",borderRadius:"6px",marginBottom:"24px"},children:(0,i.jsx)("a",{href:"/login",style:{color:"#007bff",textDecoration:"none"},children:"Log in to join the discussion"})}),en.length>0?(0,i.jsx)("div",{children:en.map(e=>(0,i.jsx)(T,{comment:e,depth:0},e.id))}):(0,i.jsx)("div",{style:{textAlign:"center",padding:"40px",color:"#666"},children:"No comments yet. Be the first to share your thoughts!"})]})]})]})}},9008:function(e,t,o){e.exports=o(7828)}},function(e){e.O(0,[424,487,888,774,179],function(){return e(e.s=7411)}),_N_E=e.O()}]);