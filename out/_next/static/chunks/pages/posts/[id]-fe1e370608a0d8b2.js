(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[646],{7411:function(e,t,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/posts/[id]",function(){return o(5591)}])},5591:function(e,t,o){"use strict";o.r(t);var i=o(5893),n=o(7294),r=o(1163),l=o(9008),s=o.n(l),a=o(7331),d=o(3479);let c=e=>{var t;let{comment:o,depth:n,post:r,replyTexts:l,showReplyForms:s,isAuthenticated:a,replyingTo:d,onToggleReplyForm:p,onReplyTextChange:x,onCreateReply:u,formatTimeAgo:h}=e,g={backgroundColor:"#28a745",color:"white",border:"none",borderRadius:"4px",padding:"6px 12px",fontSize:"12px",cursor:"pointer",opacity:d===o.id?.6:1,pointerEvents:d===o.id?"none":"auto"};return(0,i.jsxs)("div",{style:{marginLeft:"".concat(Math.min(20*n,100),"px"),borderLeft:n>0?"2px solid #e1e1e1":"none",paddingLeft:n>0?"16px":"0",marginBottom:"16px"},children:[(0,i.jsxs)("div",{style:{backgroundColor:"#f8f9fa",border:"1px solid #e9ecef",borderRadius:"6px",padding:"16px",marginBottom:"12px"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,i.jsxs)("span",{style:{color:"#333",fontWeight:"600"},children:["u/",o.createdBy.username]}),(0,i.jsxs)("span",{style:{color:"#28a745",fontSize:"12px",marginLeft:"4px"},children:["(",o.createdBy.points," pts)"]})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"12px"},children:[(0,i.jsxs)("span",{style:{color:"#28a745",fontWeight:"600"},children:["▲ ",o.points]}),(0,i.jsx)("span",{style:{color:"#ccc"},children:"•"}),(0,i.jsx)("span",{style:{color:"#888"},children:h(o.createdAt)})]})]}),(0,i.jsx)("div",{style:{fontSize:"14px",lineHeight:"1.5",marginBottom:"12px",color:"#333",whiteSpace:"pre-wrap"},children:o.text}),(0,i.jsx)("div",{style:{display:"flex",gap:"12px"},children:a&&(0,i.jsx)("button",{style:{background:"none",border:"none",color:"#007bff",fontSize:"12px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"background-color 0.2s ease"},onClick:()=>p(o.id),children:"Reply"})}),s[o.id]&&(0,i.jsxs)("div",{style:{marginTop:"16px",padding:"16px",backgroundColor:"white",border:"1px solid #ddd",borderRadius:"6px"},children:[(0,i.jsx)("textarea",{value:l[o.id]||"",onChange:e=>x(o.id,e.target.value),placeholder:"Write a reply...",style:{width:"100%",padding:"10px 12px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"13px",fontFamily:"inherit",resize:"vertical",boxSizing:"border-box",outline:"none"},rows:3}),(0,i.jsxs)("div",{style:{display:"flex",gap:"8px",marginTop:"12px"},children:[(0,i.jsx)("button",{onClick:()=>u(o.id,r.id),disabled:d===o.id||!(null===(t=l[o.id])||void 0===t?void 0:t.trim()),style:g,children:d===o.id?"Replying...":"Reply"}),(0,i.jsx)("button",{onClick:()=>p(o.id),style:{backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"4px",padding:"6px 12px",fontSize:"12px",cursor:"pointer"},children:"Cancel"})]})]})]}),o.replies&&o.replies.length>0&&o.replies.map(e=>(0,i.jsx)(c,{comment:e,depth:n+1,post:r,replyTexts:l,showReplyForms:s,isAuthenticated:a,replyingTo:d,onToggleReplyForm:p,onReplyTextChange:x,onCreateReply:u,formatTimeAgo:h},e.id))]})};t.default=()=>{var e,t;let[o,l]=(0,n.useState)(null),[p,x]=(0,n.useState)(!0),[u,h]=(0,n.useState)(""),[g,m]=(0,n.useState)(""),[y,f]=(0,n.useState)({}),[b,j]=(0,n.useState)({}),[v,w]=(0,n.useState)(!1),[S,C]=(0,n.useState)(null),[k,R]=(0,n.useState)(null),B=(0,r.useRouter)(),{id:z}=B.query;(0,n.useEffect)(()=>{z&&(T(),F())},[z]);let F=async()=>{try{if((0,d.$8)()){let e=localStorage.getItem("userId");if(!e)throw Error("User not logged in");let t=await d.ON.getCurrentUser(e);R(t)}}catch(e){console.error("Failed to load current user:",e)}},T=async()=>{try{let e=await d.WY.getPostById(z),t=await d.uv.getAllCommunities();if(e.success&&e.data&&t.data){e.data.community=t.data.find(t=>t.posts.find(t=>t.id===e.data.id));let o={...e.data,comments:I(e.data.comments||[])};l(o)}else h("Post not found")}catch(e){h("Failed to load post"),console.error("Error loading post:",e)}finally{x(!1)}},I=e=>{let t=new Map,o=[];return e.forEach(e=>{t.set(e.id,{...e,replies:[]})}),e.forEach(e=>{var i;let n=t.get(e.id);if(null===(i=e.parent)||void 0===i?void 0:i.id){let i=t.get(e.parent.id);i?i.replies.push(n):o.push(n)}else o.push(n)}),o},E=async e=>{if(e.preventDefault(),g.trim()&&(null==o?void 0:o.id)){if(!(0,d.$8)()||!(null==k?void 0:k.id)){await B.push("/login");return}w(!0),h("");try{let e={text:g.trim(),postId:o.id,userId:k.id};console.log("Creating comment with data:",e);let t=await d.a$.createComment(e);if(t.success)m(""),await T(),console.log("Comment created successfully");else{let e=t.error||"Failed to create comment";h(e),console.error("Failed to create comment:",e)}}catch(e){h((null==e?void 0:e.message)||"Failed to create comment"),console.error("Error creating comment:",e)}finally{w(!1)}}},_=(0,n.useCallback)(async(e,t)=>{let o=y[e];if(null==o?void 0:o.trim()){if(!(0,d.$8)()||!(null==k?void 0:k.id)){await B.push("/login");return}C(e),h("");try{let i={text:o.trim(),postId:t,userId:k.id,parentId:e};console.log("Creating reply with data:",i);let n=await d.a$.createReply(i);if(n.success)f(t=>({...t,[e]:""})),j(t=>({...t,[e]:!1})),await T(),console.log("Reply created successfully");else{let e=n.error||"Failed to create reply";h(e),console.error("Failed to create reply:",e)}}catch(e){h((null==e?void 0:e.message)||"Failed to create reply"),console.error("Error creating reply:",e)}finally{C(null)}}},[y,k,B]),A=(0,n.useCallback)(e=>{j(t=>({...t,[e]:!t[e]})),h("")},[]),D=(0,n.useCallback)((e,t)=>{f(o=>({...o,[e]:t}))},[]),P=(0,n.useCallback)(e=>{let t=new Date,o=new Date(e),i=Math.floor((t.getTime()-o.getTime())/36e5),n=Math.floor(i/24);return i<1?"Less than an hour ago":i<24?"".concat(i," hour").concat(i>1?"s":""," ago"):n<7?"".concat(n," day").concat(n>1?"s":""," ago"):o.toLocaleDateString()},[]),W={maxWidth:"800px",margin:"0 auto",padding:"20px",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},L={color:"#ccc"},N={display:"flex",alignItems:"center",gap:"4px"},$={width:"100%",padding:"12px 16px",border:"2px solid #e1e1e1",borderRadius:"6px",fontSize:"14px",fontFamily:"inherit",resize:"vertical",boxSizing:"border-box",lineHeight:"1.5",outline:"none"},M={borderColor:"#007bff",boxShadow:"0 0 0 3px rgba(0, 123, 255, 0.1)"},O={backgroundColor:"#f8d7da",color:"#721c24",padding:"12px 16px",borderRadius:"6px",marginBottom:"20px",border:"1px solid #f5c6cb"};if(p)return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(s(),{children:[(0,i.jsx)("title",{children:"Post | Setback"}),(0,i.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"})]}),(0,i.jsx)(a.Z,{}),(0,i.jsx)("div",{style:W,children:(0,i.jsx)("div",{style:{textAlign:"center",padding:"60px",fontSize:"18px",color:"#666"},children:"Loading post..."})})]});if(!o)return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(s(),{children:[(0,i.jsx)("title",{children:"Post Not Found | Setback"}),(0,i.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"})]}),(0,i.jsx)(a.Z,{}),(0,i.jsx)("div",{style:W,children:(0,i.jsx)("div",{style:O,children:"Post not found"})})]});let H=o.comments||[];return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(s(),{children:[(0,i.jsxs)("title",{children:[o.title," | Setback"]}),(0,i.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"})]}),(0,i.jsx)(a.Z,{}),(0,i.jsxs)("div",{style:W,children:[(0,i.jsx)("button",{onClick:()=>B.back(),style:{backgroundColor:"transparent",color:"#007bff",border:"1px solid #007bff",borderRadius:"6px",padding:"8px 16px",fontSize:"14px",cursor:"pointer",marginBottom:"20px",textDecoration:"none",display:"inline-block"},children:"← Back"}),u&&(0,i.jsx)("div",{style:O,children:u}),(0,i.jsxs)("div",{style:{backgroundColor:"white",border:"1px solid #e1e1e1",borderRadius:"8px",padding:"24px",marginBottom:"24px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[(0,i.jsx)("h1",{style:{fontSize:"28px",fontWeight:"700",color:"#1a1a1a",marginBottom:"16px",lineHeight:"1.3"},children:o.title}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"20px",fontSize:"14px",color:"#666"},children:[(0,i.jsxs)("span",{style:{color:"#007bff",fontWeight:"600",textDecoration:"none",cursor:"pointer"},onClick:()=>{var e;return B.push("/communities/".concat(null==o?void 0:null===(e=o.community)||void 0===e?void 0:e.id))},children:["r/",o.community?o.community.name:"community"]}),(0,i.jsx)("span",{style:L,children:"•"}),(0,i.jsx)("span",{children:"Posted by "}),(0,i.jsxs)("span",{style:{color:"#333",fontWeight:"600"},children:["u/",o.user.username]}),(0,i.jsxs)("span",{style:{color:"#28a745",fontSize:"12px",marginLeft:"4px"},children:["(",o.user.points," pts)"]}),(0,i.jsx)("span",{style:L,children:"•"}),(0,i.jsx)("span",{style:{color:"#888"},children:P(o.createdAt)})]}),(0,i.jsx)("div",{style:{fontSize:"16px",lineHeight:"1.6",color:"#333",marginBottom:"20px",whiteSpace:"pre-wrap"},children:o.content}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"16px",paddingTop:"16px",borderTop:"1px solid #e1e1e1",fontSize:"14px",color:"#666"},children:[(0,i.jsxs)("div",{style:N,children:[(0,i.jsx)("span",{children:"▲"}),(0,i.jsx)("span",{children:(null===(e=o.comments)||void 0===e?void 0:e.length)||0})]}),(0,i.jsxs)("div",{style:N,children:[(0,i.jsx)("span",{children:"\uD83D\uDCAC"}),(0,i.jsxs)("span",{children:[(null===(t=o.comments)||void 0===t?void 0:t.length)||0," comments"]})]})]})]}),(0,i.jsxs)("div",{style:{backgroundColor:"white",border:"1px solid #e1e1e1",borderRadius:"8px",padding:"24px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[(0,i.jsxs)("h3",{style:{fontSize:"20px",fontWeight:"600",color:"#333",marginBottom:"20px"},children:["Comments (",H.length,")"]}),(0,d.$8)()&&k?(0,i.jsxs)("form",{onSubmit:E,style:{marginBottom:"24px",paddingBottom:"24px",borderBottom:"1px solid #e1e1e1"},children:[(0,i.jsx)("textarea",{value:g,onChange:e=>m(e.target.value),placeholder:"Share your thoughts...",style:$,rows:4,required:!0,disabled:v,onFocus:e=>Object.assign(e.target.style,M),onBlur:e=>Object.assign(e.target.style,$)}),(0,i.jsx)("button",{type:"submit",disabled:v||!g.trim(),style:{backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"6px",padding:"10px 20px",fontSize:"14px",fontWeight:"600",cursor:"pointer",marginTop:"12px",opacity:v?.6:1,pointerEvents:v?"none":"auto"},children:v?"Posting...":"Post Comment"})]}):(0,i.jsx)("div",{style:{textAlign:"center",padding:"20px",backgroundColor:"#f8f9fa",borderRadius:"6px",marginBottom:"24px"},children:(0,i.jsx)("a",{href:"/login",style:{color:"#007bff",textDecoration:"none"},children:"Log in to join the discussion"})}),H.length>0?(0,i.jsx)("div",{children:H.map(e=>(0,i.jsx)(c,{comment:e,depth:0,post:o,replyTexts:y,showReplyForms:b,isAuthenticated:(0,d.$8)(),replyingTo:S,onToggleReplyForm:A,onReplyTextChange:D,onCreateReply:_,formatTimeAgo:P},e.id))}):(0,i.jsx)("div",{style:{textAlign:"center",padding:"40px",color:"#666"},children:"No comments yet. Be the first to share your thoughts!"})]})]})]})}},9008:function(e,t,o){e.exports=o(3867)}},function(e){e.O(0,[424,219,888,774,179],function(){return e(e.s=7411)}),_N_E=e.O()}]);